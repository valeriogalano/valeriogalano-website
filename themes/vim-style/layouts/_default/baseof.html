<!DOCTYPE html>
<html lang='{{ default "en" .Site.LanguageCode }}'>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  {{/* Titles and canonical */}}
  {{ $pageTitle := cond .IsHome .Site.Title .Title }}
  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ $pageTitle }} | {{ .Site.Title }}{{ end }}</title>
  {{ $canonical := .Permalink | default .Site.BaseURL }}
  <link rel="canonical" href="{{ $canonical }}" />

  {{/* Meta description & robots */}}
  {{ $desc := or .Params.description (.Summary | plainify) }}
  {{ if not $desc }}{{ $desc = .Site.Params.description }}{{ end }}
  {{ if $desc }}<meta name="description" content="{{ $desc }}" />{{ end }}
  {{ with .Site.Params.author }}<meta name="author" content="{{ . }}" />{{ end }}
  {{ $robots := cond (.Params.noindex) "noindex, nofollow" "index, follow" }}
  <meta name="robots" content="{{ $robots }}" />
  {{/* Favicon & PWA basics */}}
  {{ $favicon := .Site.Params.Favicon | default "/img/logo.png" }}
  <link rel="icon" type="image/png" href="{{ $favicon }}">
  {{/* If you add sized icons, uncomment the lines below and provide the files in /static/img */}}
  {{/* <link rel="icon" type="image/png" sizes="32x32" href="/img/favicon-32x32.png"> */}}
  {{/* <link rel="icon" type="image/png" sizes="16x16" href="/img/favicon-16x16.png"> */}}
  {{/* <link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png"> */}}
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/img/logo.svg" color="#00ff66">
  <meta name="theme-color" content="#000000" />
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
  {{ with .Site.Params.mastodon }}<link rel="me" href="{{ . }}">{{ end }}
  {{/* Fonts: prefer JetBrains Mono, fallback monospace */}}
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">

  {{/* Social: Open Graph & Twitter */}}
  {{ $siteName := .Site.Title }}
  {{ $type := cond .IsHome "website" "article" }}
  {{ $img := or .Params.images (slice (.Site.Params.socialImage)) }}
  {{ $imgUrl := (index $img 0) | absURL }}
  <meta property="og:site_name" content="{{ $siteName }}" />
  <meta property="og:locale" content='{{ default "en_US" .Site.LanguageCode }}' />
  <meta property="og:type" content="{{ $type }}" />
  <meta property="og:title" content="{{ $pageTitle }}" />
  {{ if $desc }}<meta property="og:description" content="{{ $desc }}" />{{ end }}
  <meta property="og:url" content="{{ $canonical }}" />
  {{ if $imgUrl }}
  <meta property="og:image" content="{{ $imgUrl }}" />
  <meta property="og:image:secure_url" content="{{ $imgUrl }}" />
  <meta property="og:image:type" content="image/png" />
  {{/* Optional static dimensions to help some scrapers (Telegram, etc.) */}}
  <meta property="og:image:width" content="487" />
  <meta property="og:image:height" content="512" />
  {{ end }}

  <meta name="twitter:card" content="summary_large_image" />
  {{ with .Site.Params.twitter }}<meta name="twitter:site" content="{{ . }}" />{{ end }}
  <meta name="twitter:title" content="{{ $pageTitle }}" />
  {{ if $desc }}<meta name="twitter:description" content="{{ $desc }}" />{{ end }}
  {{ if $imgUrl }}<meta name="twitter:image" content="{{ $imgUrl }}" />{{ end }}

  {{/* JSON-LD removed to satisfy static validator; can be re-added if needed. */}}

  {{ $css := resources.Get "css/main.css" | resources.Minify | resources.Fingerprint }}
  <link rel="stylesheet" href="{{ $css.RelPermalink }}" integrity="{{ $css.Data.Integrity }}" />
</head>
<body class="vs-body">
  {{ partial "header.html" . }}
  {{ partial "nav_links.html" . }}

  <main id="content" class="vs-content">
    {{ block "main" . }}{{ end }}
  </main>

  <!-- Spacer to reserve exactly the footer height so content never sits beneath the fixed footer -->
  <div id="vs-footer-spacer" aria-hidden="true"></div>

  {{ partial "command_nav.html" . }}
  {{ partial "footer.html" . }}

  {{/* Expose routes from config.toml to JS as window.TG_ROUTES */}}
  {{ partial "route_data.html" . }}

  {{ $cmd := resources.Get "js/command-nav.js" | resources.Minify | resources.Fingerprint }}
  <script src="{{ $cmd.RelPermalink }}" integrity="{{ $cmd.Data.Integrity }}" defer></script>
  {{ $linknav := resources.Get "js/link-nav.js" | resources.Minify | resources.Fingerprint }}
  <script src="{{ $linknav.RelPermalink }}" integrity="{{ $linknav.Data.Integrity }}" defer></script>
</body>
</html>
